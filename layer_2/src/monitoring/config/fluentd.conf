<source>
  @type monitor_agent
  bind 0.0.0.0
  port 24220
</source>

<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<filter docker.**>
  @type stdout
</filter>

<filter docker.**>
  @type record_transformer
  <record>
    hostname "#{Socket.gethostname}"
    tag ${tag}
    container_id ${tag_parts[1]}
    service_name ${tag_parts[2]}
    fluentd_hostname "#{ENV['FLUENTD_HOSTNAME']}"
  </record>
</filter>

<match docker.**>
    @type copy
    <store>
        @type loki
        url "http://loki:3100"
        flush_interval 10s
        flush_at_shutdown true
        buffer_chunk_limit 1m
        <label>
            service_name
            fluentd_hostname
        </label>
    </store>
</match>